<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÊòüËæ∞ÂØºËà™ - Êé¢Á¥¢Êï∞Â≠óÂÆáÂÆô</title>
    <style>
        /* Âü∫Á°ÄÊ†∑Âºè */
        :root {
            --primary: #6C5B7B;
            --secondary: #C06C84;
            --accent: #F8B195;
            --text: #2D3047;
        }

        body {
            margin: 0;
            background: linear-gradient(135deg, #F8F9FA 0%, #E9ECEF 100%);
            color: var(--text);
            font-family: 'Microsoft YaHei', sans-serif;
            min-height: 100vh;
        }

        /* Â§¥ÈÉ®Ê†∑Âºè */
        .header {
            text-align: center;
            padding: 2rem;
            position: relative;
            z-index: 2;
        }

        .title {
            font-size: 3.5rem;
            color: var(--primary);
            text-shadow: 2px 2px 0px rgba(255,255,255,0.5);
            letter-spacing: 2px;
            margin: 1rem 0;
        }

        /* ÂØºËà™ÁΩëÊ†º */
        .nav-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
            padding: 3rem;
            max-width: 1200px;
            margin: 0 auto;
            position: relative;
            z-index: 2;
        }

        /* ÂØºËà™Âç°Áâá */
        .nav-card {
            background: rgba(255,255,255,0.95);
            border-radius: 12px;
            padding: 2rem;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            border: none;
            text-decoration: none;
            display: block;
        }

        .nav-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 20px rgba(0, 0, 0, 0.1);
        }

        /* ÁÉüËä±ÁîªÂ∏É */
        #fireworks {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
        }

        .nav-card h3 {
            color: var(--primary);
            margin: 0 0 1rem;
            font-size: 1.5rem;
        }

        .nav-card p {
            color: #6C757D;
            line-height: 1.6;
            margin: 0;
        }

        #adminPanel {
            display: none;
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
        }

        #adminPanel div {
            background: rgba(255,255,255,0.98) !important;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            border: 1px solid rgba(0,0,0,0.05);
            border-radius: 12px;
            padding: 20px;
            width: 300px;
        }

        #adminBtn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
            background: var(--accent);
            border: none;
            padding: 12px 24px;
            color: white;
            border-radius: 30px;
            cursor: pointer;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: transform 0.2s;
        }

        #adminBtn:hover {
            transform: scale(1.05);
        }

        input, textarea {
            width: 100%;
            padding: 10px;
            margin-bottom: 12px;
            border: 1px solid rgba(0,0,0,0.1);
            border-radius: 8px;
            font-family: inherit;
        }

        button[type="submit"] {
            background: var(--secondary);
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 8px;
            color: white;
            cursor: pointer;
            transition: background 0.3s;
        }

        button[type="submit"]:hover {
            background: #B35771;
        }

        @keyframes glow {
            0%, 100% { text-shadow: 0 0 15px var(--accent); }
            50% { text-shadow: 0 0 25px var(--accent); }
        }

        /* Êñ∞Â¢ûÂä®ÊÄÅËÉåÊôØ */
        body::after {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, 
                rgba(108, 91, 123, 0.05) 0%, 
                rgba(192, 108, 132, 0.05) 100%);
            z-index: 0;
        }
    </style>
</head>
<body>
    <canvas id="fireworks"></canvas>
    
    <div class="header">
        <h1 class="title">‚ú® ÊòüËæ∞ÂØºËà™</h1>
    </div>

    <div class="nav-grid">
        <!-- Âä®ÊÄÅÁîüÊàêÁöÑÂØºËà™Âç°Áâá -->
    </div>

    <a href="admin.html" id="adminBtn">üõ†Ô∏è ÁÆ°ÁêÜ</a>

    <script>
        // ÁÉüËä±Á≤íÂ≠êÁ≥ªÁªü
        class Firework {
            constructor(canvas) {
                this.canvas = canvas;
                this.ctx = canvas.getContext('2d');
                this.particles = [];
                this.resize();
                window.addEventListener('resize', () => this.resize());
                
                // ÂàùÂßãÁÉüËä±Ë°®Êºî
                this.createFirework();
                this.animate();
            }

            resize() {
                this.canvas.width = window.innerWidth;
                this.canvas.height = window.innerHeight;
            }

            createFirework() {
                const colors = ['#FF6B6B', '#4ECDC4', '#45B7D1', '#96CEB4', '#FFEEAD'];
                for (let i = 0; i < 150; i++) {
                    this.particles.push({
                        x: this.canvas.width/2,
                        y: this.canvas.height/2,
                        color: colors[Math.floor(Math.random() * colors.length)],
                        radius: Math.random() * 2,
                        speed: {
                            x: (Math.random() - 0.5) * 10,
                            y: (Math.random() - 0.5) * 10
                        },
                        alpha: 1
                    });
                }
            }

            animate() {
                this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);
                
                this.particles.forEach((p, i) => {
                    p.x += p.speed.x;
                    p.y += p.speed.y;
                    p.alpha -= 0.01;
                    
                    this.ctx.beginPath();
                    this.ctx.arc(p.x, p.y, p.radius, 0, Math.PI * 2);
                    this.ctx.fillStyle = p.color;
                    this.ctx.globalAlpha = p.alpha;
                    this.ctx.fill();
                    
                    if (p.alpha <= 0) {
                        this.particles.splice(i, 1);
                    }
                });

                requestAnimationFrame(() => this.animate());
            }
        }

        // ÂàùÂßãÂåñÁÉüËä±
        window.addEventListener('load', () => {
            new Firework(document.getElementById('fireworks'));
            
            // ÁÇπÂáªÈ°µÈù¢‰ªªÊÑè‰ΩçÁΩÆËß¶ÂèëÊñ∞ÁÉüËä±
            document.addEventListener('click', () => {
                new Firework(document.getElementById('fireworks'));
            });
        });

        // Êï∞ÊçÆÁÆ°ÁêÜ
        let navData = JSON.parse(localStorage.getItem('navData') || '[]');
        
        // Âú®sha256ÂáΩÊï∞ÂêéÊ∑ªÂä†Âä†ÂØÜËß£ÂØÜÊñπÊ≥ï
        const cryptoUtils = {
            key: null,

            async generateKey(password) {
                const keyMaterial = await crypto.subtle.importKey(
                    "raw",
                    new TextEncoder().encode(password),
                    "PBKDF2",
                    false,
                    ["deriveKey"]
                );
                
                return await crypto.subtle.deriveKey(
                    {
                        name: "PBKDF2",
                        salt: new TextEncoder().encode("StarryNavSalt"),
                        iterations: 100000,
                        hash: "SHA-256"
                    },
                    keyMaterial,
                    { name: "AES-GCM", length: 256 },
                    true,
                    ["encrypt", "decrypt"]
                );
            },

            async encrypt(text, password) {
                const key = await this.generateKey(password);
                const iv = crypto.getRandomValues(new Uint8Array(12));
                const encrypted = await crypto.subtle.encrypt(
                    { name: "AES-GCM", iv },
                    key,
                    new TextEncoder().encode(text)
                );
                return btoa(String.fromCharCode(...iv) + String.fromCharCode(...new Uint8Array(encrypted)));
            },

            async decrypt(encryptedText, password) {
                try {
                    const key = await this.generateKey(password);
                    const buffer = Uint8Array.from(atob(encryptedText), c => c.charCodeAt(0));
                    const iv = buffer.slice(0, 12);
                    const data = buffer.slice(12);
                    const decrypted = await crypto.subtle.decrypt(
                        { name: "AES-GCM", iv },
                        key,
                        data
                    );
                    return new TextDecoder().decode(decrypted);
                } catch (e) {
                    console.error('Ëß£ÂØÜÂ§±Ë¥•:', e);
                    return '#';
                }
            }
        };

        // ‰øÆÊîπÂØºËà™ÂàùÂßãÂåñÈÄªËæë
        function initNav() {
            const grid = document.querySelector('.nav-grid');
            grid.innerHTML = navData.map(item => `
                <a href="#" class="nav-card" 
                   data-encrypted="${item.encrypted}" 
                   data-pwd="${item.password}"
                   onclick="handleNavClick(event)">
                    <h3>${item.name}</h3>
                    <p>${item.desc}</p>
                </a>
            `).join('');
        }

        // Ê∑ªÂä†ÁÇπÂáªÂ§ÑÁêÜÂáΩÊï∞
        async function handleNavClick(event) {
            event.preventDefault();
            const card = event.currentTarget;
            const encrypted = card.dataset.encrypted;
            const pwdHash = card.dataset.pwd;
            
            const password = prompt('ËØ∑ËæìÂÖ•ËÆøÈóÆÂØÜÁ†ÅÔºö');
            if (!password) return;
            
            const inputHash = await sha256(password);
            if (inputHash !== pwdHash) {
                alert('ËÆøÈóÆÂØÜÁ†ÅÈîôËØØ');
                return;
            }

            const realUrl = await cryptoUtils.decrypt(encrypted, password);
            window.open(realUrl, '_blank');
        }

        // ‰øÆÊîπË°®ÂçïÊèê‰∫§ÈÄªËæë
        document.getElementById('linkForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const linkPassword = prompt('ËØ∑ËÆæÁΩÆËØ•ÈìæÊé•ÁöÑËÆøÈóÆÂØÜÁ†ÅÔºö');
            if (!linkPassword) return;
            
            const newItem = {
                id: Date.now(),
                name: document.getElementById('linkName').value,
                url: document.getElementById('linkUrl').value,
                desc: document.getElementById('linkDesc').value,
                password: await sha256(linkPassword),
                encrypted: await cryptoUtils.encrypt(
                    document.getElementById('linkUrl').value,
                    linkPassword
                )
            };
            
            navData.push(newItem);
            localStorage.setItem('navData', JSON.stringify(navData));
            initNav();
            e.target.reset();
        });

        // ÂØÜÁ†ÅÈ™åËØÅ
        const sha256 = async (message) => {
            const msgBuffer = new TextEncoder().encode(message);
            const hashBuffer = await crypto.subtle.digest('SHA-256', msgBuffer);
            return Array.from(new Uint8Array(hashBuffer))
                .map(b => b.toString(16).padStart(2, '0')).join('');
        };

        // ‰øÆÊîπÁÆ°ÁêÜÊåâÈíÆÁÇπÂáª‰∫ã‰ª∂Â§ÑÁêÜ
        document.getElementById('adminBtn').addEventListener('click', async (e) => {
            e.preventDefault();
            try {
                const input = prompt('ËØ∑ËæìÂÖ•ÁÆ°ÁêÜÂØÜÁ†ÅÔºö');
                if (!input) return;
                
                e.target.textContent = 'È™åËØÅ‰∏≠...';
                e.target.disabled = true;

                const hashedInput = await sha256(input);
                if (hashedInput === '185dc7daea25b79cd857b57635f4ab644deb016ab9051e00c9c45de8574ebfb8') {
                    // ‰ΩøÁî®localStorageÊõø‰ª£sessionStorage
                    localStorage.setItem('adminAuth', 'true');
                    // Ê∑ªÂä†Êó∂Èó¥Êà≥Èò≤Ê≠¢ÁºìÂ≠ò
                    window.location.href = 'admin.html?t=' + Date.now();
                } else {
                    alert('ÂØÜÁ†ÅÈîôËØØ');
                }
            } catch (error) {
                console.error('ËÆ§ËØÅÂá∫Èîô:', error);
                alert('ÂèëÁîüÈîôËØØÔºåËØ∑Êü•ÁúãÊéßÂà∂Âè∞');
            } finally {
                e.target.textContent = 'üõ†Ô∏è ÁÆ°ÁêÜ';
                e.target.disabled = false;
            }
        });

        // ‰∏¥Êó∂Ë∞ÉËØï‰ª£Á†ÅÔºàÂèØÂú®ÊéßÂà∂Âè∞ËøêË°åÔºâ
        async function getHash(pwd) {
            const hash = await sha256(pwd);
            console.log('ÂìàÂ∏åÂÄºÔºö', hash);
            return hash;
        }
        getHash('ÊÇ®ÁöÑÊñ∞ÂØÜÁ†Å');

        // Êñ∞Â¢ûÔºöÊ∏≤ÊüìÂØºËà™ÂàóË°®
        function renderNavList() {
            const container = document.getElementById('navList');
            container.innerHTML = navData.map(item => `
                <div class="nav-item" data-id="${item.id}" style="margin-bottom:15px; padding:15px; background:rgba(0,0,0,0.05); border-radius:8px;">
                    <input type="text" value="${item.name}" 
                           style="width:100%; margin-bottom:5px;" 
                           onchange="updateNavItem(${item.id}, 'name', this.value)">
                    <input type="url" value="${item.url}" 
                           style="width:100%; margin-bottom:5px;" 
                           onchange="handleUrlChange(${item.id}, this.value)">
                    <textarea style="width:100%; margin-bottom:5px;" 
                              onchange="updateNavItem(${item.id}, 'desc', this.value)">${item.desc}</textarea>
                    <div style="display:flex; gap:5px;">
                        <input type="password" placeholder="Êñ∞ËÆøÈóÆÂØÜÁ†Å" 
                               style="flex:1;" id="pwd-${item.id}">
                        <button onclick="updatePassword(${item.id})" 
                                style="padding:5px 10px; background:var(--primary); color:white; border:none; border-radius:4px;">
                            Êõ¥Êñ∞ÂØÜÁ†Å
                        </button>
                        <button onclick="deleteNavItem(${item.id})" 
                                style="padding:5px 10px; background:#ff4757; color:white; border:none; border-radius:4px;">
                            Âà†Èô§
                        </button>
                    </div>
                </div>
            `).join('');
        }

        // Êñ∞Â¢ûÔºöÊõ¥Êñ∞ÂØºËà™È°π
        function updateNavItem(id, field, value) {
            const item = navData.find(i => i.id === id);
            if (item) {
                item[field] = value;
                localStorage.setItem('navData', JSON.stringify(navData));
                initNav(); // Êõ¥Êñ∞ÂâçÁ´ØÊòæÁ§∫
            }
        }

        // Êñ∞Â¢ûÔºöÂ§ÑÁêÜURL‰øÆÊîπÔºàÈúÄË¶ÅÈáçÊñ∞Âä†ÂØÜÔºâ
        async function handleUrlChange(id, newUrl) {
            const item = navData.find(i => i.id === id);
            if (!item) return;

            const password = prompt('ËØ∑ËæìÂÖ•ÂΩìÂâçËÆøÈóÆÂØÜÁ†Å‰ª•‰øÆÊîπÈìæÊé•Ôºö');
            if (!password) return;

            // È™åËØÅÂØÜÁ†Å
            const inputHash = await sha256(password);
            if (inputHash !== item.password) {
                alert('ÂØÜÁ†ÅÈîôËØØÔºåÊó†Ê≥ï‰øÆÊîπ');
                return;
            }

            // ÈáçÊñ∞Âä†ÂØÜURL
            item.url = newUrl;
            item.encrypted = await cryptoUtils.encrypt(newUrl, password);
            localStorage.setItem('navData', JSON.stringify(navData));
            initNav();
        }

        // Êñ∞Â¢ûÔºöÊõ¥Êñ∞ÂØÜÁ†Å
        async function updatePassword(id) {
            const item = navData.find(i => i.id === id);
            if (!item) return;

            const newPassword = document.getElementById(`pwd-${id}`).value;
            if (!newPassword) {
                alert('ËØ∑ËæìÂÖ•Êñ∞ÂØÜÁ†Å');
                return;
            }

            // Ëß£ÂØÜÂéüURL
            const oldPassword = prompt('ËØ∑ËæìÂÖ•ÂéüËÆøÈóÆÂØÜÁ†ÅÔºö');
            const oldHash = await sha256(oldPassword);
            if (oldHash !== item.password) {
                alert('ÂéüÂØÜÁ†ÅÈîôËØØ');
                return;
            }

            try {
                const decryptedUrl = await cryptoUtils.decrypt(item.encrypted, oldPassword);
                // ‰ΩøÁî®Êñ∞ÂØÜÁ†ÅÈáçÊñ∞Âä†ÂØÜ
                item.password = await sha256(newPassword);
                item.encrypted = await cryptoUtils.encrypt(decryptedUrl, newPassword);
                localStorage.setItem('navData', JSON.stringify(navData));
                alert('ÂØÜÁ†ÅÊõ¥Êñ∞ÊàêÂäü');
                renderNavList();
            } catch (e) {
                alert('ÂØÜÁ†ÅÊõ¥Êñ∞Â§±Ë¥•Ôºö' + e.message);
            }
        }

        // Êñ∞Â¢ûÔºöÂà†Èô§ÂØºËà™È°π
        function deleteNavItem(id) {
            if (confirm('Á°ÆÂÆöË¶ÅÂà†Èô§Ëøô‰∏™ÂØºËà™È°πÂêóÔºü')) {
                navData = navData.filter(i => i.id !== id);
                localStorage.setItem('navData', JSON.stringify(navData));
                renderNavList();
                initNav();
            }
        }

        // ÂàùÂßãÂåñ
        initNav();
    </script>
</body>
</html> 