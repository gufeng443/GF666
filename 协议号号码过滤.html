<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ•°æ®è¿‡æ»¤å·¥å…·</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        .container {
            width: 100%;
            max-width: 900px;
            background-color: white;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            padding: 30px;
        }
        
        h1 {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 30px;
            font-weight: 600;
        }
        
        .upload-area {
            border: 2px dashed #3498db;
            border-radius: 8px;
            padding: 40px 20px;
            text-align: center;
            margin-bottom: 25px;
            transition: all 0.3s ease;
            background-color: #f8fafc;
            cursor: pointer;
        }
        
        .upload-area:hover, .upload-area.dragover {
            background-color: #e3f2fd;
            border-color: #2980b9;
        }
        
        .upload-icon {
            font-size: 48px;
            color: #3498db;
            margin-bottom: 15px;
        }
        
        .upload-text {
            color: #7f8c8d;
            margin-bottom: 10px;
        }
        
        .browse-link {
            color: #3498db;
            text-decoration: underline;
            cursor: pointer;
        }
        
        .file-input {
            display: none;
        }
        
        .filter-section {
            margin-bottom: 25px;
        }
        
        .section-title {
            font-size: 18px;
            color: #2c3e50;
            margin-bottom: 10px;
            font-weight: 500;
        }
        
        .filter-textarea {
            width: 100%;
            height: 150px;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            resize: vertical;
            font-family: monospace;
        }
        
        .filter-textarea:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);
        }
        
        .button-container {
            display: flex;
            justify-content: center;
            margin-top: 30px;
        }
        
        .filter-btn {
            background-color: #3498db;
            color: white;
            border: none;
            border-radius: 6px;
            padding: 12px 30px;
            font-size: 16px;
            cursor: pointer;
            transition: background-color 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .filter-btn:hover {
            background-color: #2980b9;
        }
        
        .filter-btn:disabled {
            background-color: #bdc3c7;
            cursor: not-allowed;
        }
        
        .result-section {
            margin-top: 30px;
            display: none;
        }
        
        .result-info {
            background-color: #f1f8e9;
            border-left: 4px solid #7cb342;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 4px;
        }
        
        .download-buttons {
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        .download-btn {
            background-color: #2ecc71;
            color: white;
            border: none;
            border-radius: 6px;
            padding: 12px 25px;
            font-size: 16px;
            cursor: pointer;
            transition: background-color 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .download-btn:hover {
            background-color: #27ae60;
        }
        
        .download-removed-btn {
            background-color: #e74c3c;
        }
        
        .download-removed-btn:hover {
            background-color: #c0392b;
        }
        
        .file-info {
            margin-top: 15px;
            font-size: 14px;
            color: #7f8c8d;
        }
        
        .error-message {
            color: #e74c3c;
            margin-top: 10px;
            font-size: 14px;
            display: none;
        }
        
        .stats-container {
            display: flex;
            justify-content: space-around;
            margin-top: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .stat-box {
            background-color: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            flex: 1;
            min-width: 150px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        
        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #2c3e50;
        }
        
        .stat-label {
            font-size: 14px;
            color: #7f8c8d;
            margin-top: 5px;
        }
        
        @media (max-width: 600px) {
            .container {
                padding: 20px;
            }
            
            h1 {
                font-size: 24px;
            }
            
            .upload-area {
                padding: 30px 15px;
            }
            
            .download-buttons {
                flex-direction: column;
                align-items: center;
            }
            
            .download-btn {
                width: 100%;
                max-width: 250px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>æ•°æ®è¿‡æ»¤å·¥å…·</h1>
        
        <div class="upload-area" id="uploadArea">
            <div class="upload-icon">ğŸ“</div>
            <p class="upload-text">æ‹–æ”¾æ–‡ä»¶åˆ°æ­¤å¤„æˆ– <span class="browse-link" id="browseLink">æµè§ˆæ–‡ä»¶</span></p>
            <p class="file-info" id="fileInfo">æœªé€‰æ‹©æ–‡ä»¶</p>
            <input type="file" id="fileInput" class="file-input" accept=".txt,.csv,.log">
        </div>
        
        <div class="filter-section">
            <div class="section-title">éœ€è¦è¿‡æ»¤çš„æ•°æ®ï¼ˆæ¯è¡Œä¸€ä¸ªå·ç ï¼‰</div>
            <textarea class="filter-textarea" id="filterData" placeholder="è¯·è¾“å…¥éœ€è¦è¿‡æ»¤çš„æ•°æ®ï¼Œæ¯è¡Œä¸€ä¸ªå·ç "></textarea>
            <div class="error-message" id="filterError">è¯·è¾“å…¥éœ€è¦è¿‡æ»¤çš„æ•°æ®</div>
        </div>
        
        <div class="button-container">
            <button class="filter-btn" id="filterBtn" disabled>
                <span>æ‰§è¡Œè¿‡æ»¤</span>
            </button>
        </div>
        
        <div class="result-section" id="resultSection">
            <div class="result-info">
                <p>è¿‡æ»¤å®Œæˆï¼</p>
            </div>
            
            <div class="stats-container">
                <div class="stat-box">
                    <div class="stat-value" id="originalCount">0</div>
                    <div class="stat-label">åŸå§‹æ•°æ®è¡Œæ•°</div>
                </div>
                <div class="stat-box">
                    <div class="stat-value" id="filteredCount">0</div>
                    <div class="stat-label">è¿‡æ»¤åè¡Œæ•°</div>
                </div>
                <div class="stat-box">
                    <div class="stat-value" id="removedCount">0</div>
                    <div class="stat-label">è¢«è¿‡æ»¤è¡Œæ•°</div>
                </div>
            </div>
            
            <div class="download-buttons">
                <button class="download-btn" id="downloadFilteredBtn">
                    <span>ä¸‹è½½è¿‡æ»¤åçš„æ•°æ®</span>
                </button>
                <button class="download-btn download-removed-btn" id="downloadRemovedBtn">
                    <span>ä¸‹è½½è¢«è¿‡æ»¤çš„æ•°æ®</span>
                </button>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const uploadArea = document.getElementById('uploadArea');
            const fileInput = document.getElementById('fileInput');
            const browseLink = document.getElementById('browseLink');
            const fileInfo = document.getElementById('fileInfo');
            const filterData = document.getElementById('filterData');
            const filterBtn = document.getElementById('filterBtn');
            const resultSection = document.getElementById('resultSection');
            const originalCount = document.getElementById('originalCount');
            const filteredCount = document.getElementById('filteredCount');
            const removedCount = document.getElementById('removedCount');
            const downloadFilteredBtn = document.getElementById('downloadFilteredBtn');
            const downloadRemovedBtn = document.getElementById('downloadRemovedBtn');
            const filterError = document.getElementById('filterError');
            
            let originalFile = null;
            let filteredContent = '';
            let removedContent = '';
            
            // æ‹–æ”¾åŠŸèƒ½
            uploadArea.addEventListener('dragover', function(e) {
                e.preventDefault();
                uploadArea.classList.add('dragover');
            });
            
            uploadArea.addEventListener('dragleave', function() {
                uploadArea.classList.remove('dragover');
            });
            
            uploadArea.addEventListener('drop', function(e) {
                e.preventDefault();
                uploadArea.classList.remove('dragover');
                
                if (e.dataTransfer.files.length) {
                    handleFile(e.dataTransfer.files[0]);
                }
            });
            
            // ç‚¹å‡»æµè§ˆæ–‡ä»¶
            browseLink.addEventListener('click', function() {
                fileInput.click();
            });
            
            fileInput.addEventListener('change', function() {
                if (fileInput.files.length) {
                    handleFile(fileInput.files[0]);
                }
            });
            
            // å¤„ç†ä¸Šä¼ çš„æ–‡ä»¶
            function handleFile(file) {
                if (file.type !== 'text/plain' && !file.name.endsWith('.csv') && !file.name.endsWith('.log')) {
                    alert('è¯·ä¸Šä¼ æ–‡æœ¬æ–‡ä»¶ï¼ˆ.txt, .csv, .logï¼‰');
                    return;
                }
                
                originalFile = file;
                fileInfo.textContent = `å·²é€‰æ‹©æ–‡ä»¶: ${file.name} (${formatFileSize(file.size)})`;
                updateFilterButtonState();
            }
            
            // æ›´æ–°è¿‡æ»¤æŒ‰é’®çŠ¶æ€
            function updateFilterButtonState() {
                const hasFile = originalFile !== null;
                const hasFilterData = filterData.value.trim() !== '';
                
                filterBtn.disabled = !hasFile || !hasFilterData;
            }
            
            // ç›‘å¬è¿‡æ»¤æ•°æ®è¾“å…¥
            filterData.addEventListener('input', function() {
                updateFilterButtonState();
                filterError.style.display = 'none';
            });
            
            // æ‰§è¡Œè¿‡æ»¤
            filterBtn.addEventListener('click', function() {
                if (!originalFile) {
                    alert('è¯·å…ˆä¸Šä¼ æ–‡ä»¶');
                    return;
                }
                
                if (filterData.value.trim() === '') {
                    filterError.style.display = 'block';
                    return;
                }
                
                const reader = new FileReader();
                
                reader.onload = function(e) {
                    const content = e.target.result;
                    const lines = content.split('\n');
                    const filterItems = filterData.value.split('\n')
                        .map(item => item.trim())
                        .filter(item => item !== '');
                    
                    originalCount.textContent = lines.length;
                    
                    // è¿‡æ»¤æ•°æ®
                    const filteredLines = [];
                    const removedLines = [];
                    
                    lines.forEach(line => {
                        // æ£€æŸ¥è¯¥è¡Œæ˜¯å¦åŒ…å«ä»»ä½•éœ€è¦è¿‡æ»¤çš„å·ç 
                        const shouldRemove = filterItems.some(item => line.includes(item));
                        
                        if (shouldRemove) {
                            removedLines.push(line);
                        } else {
                            filteredLines.push(line);
                        }
                    });
                    
                    filteredCount.textContent = filteredLines.length;
                    removedCount.textContent = removedLines.length;
                    
                    filteredContent = filteredLines.join('\n');
                    removedContent = removedLines.join('\n');
                    
                    // æ˜¾ç¤ºç»“æœåŒºåŸŸ
                    resultSection.style.display = 'block';
                };
                
                reader.readAsText(originalFile);
            });
            
            // ä¸‹è½½è¿‡æ»¤åçš„æ•°æ®
            downloadFilteredBtn.addEventListener('click', function() {
                if (!filteredContent) {
                    alert('æ²¡æœ‰å¯ä¸‹è½½çš„å†…å®¹');
                    return;
                }
                
                const blob = new Blob([filteredContent], { type: 'text/plain' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                
                a.href = url;
                a.download = originalFile ? `filtered_${originalFile.name}` : 'filtered_data.txt';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            });
            
            // ä¸‹è½½è¢«è¿‡æ»¤çš„æ•°æ®
            downloadRemovedBtn.addEventListener('click', function() {
                if (!removedContent) {
                    alert('æ²¡æœ‰å¯ä¸‹è½½çš„å†…å®¹');
                    return;
                }
                
                const blob = new Blob([removedContent], { type: 'text/plain' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                
                a.href = url;
                a.download = originalFile ? `removed_${originalFile.name}` : 'removed_data.txt';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            });
            
            // æ ¼å¼åŒ–æ–‡ä»¶å¤§å°
            function formatFileSize(bytes) {
                if (bytes === 0) return '0 Bytes';
                
                const k = 1024;
                const sizes = ['Bytes', 'KB', 'MB', 'GB'];
                const i = Math.floor(Math.log(bytes) / Math.log(k));
                
                return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
            }
        });
    </script>
</body>
</html>